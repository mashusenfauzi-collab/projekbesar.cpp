#include <iostream>
#include <fstream>
using namespace std;

void registration();
void login();

int main() {
    int choice;

    cout << "1. Registration" << endl;
    cout << "2. Login" << endl;
    cout << "3. Input Your Choice : ";
    cin >> choice;

    switch (choice) {
        case 1:
            registration();
            break;
        case 2:
            login();
            break;
        default:
            cout << "Invalid choice!" << endl;
    }
    return 0;
}

// ================= REGISTRATION =================
void registration() {
    ofstream myFile, accList;
    string userReg;

    system("cls");
    cout << "---------- REGISTER ----------" << endl;
    cout << "Enter Username : ";
    cin >> userReg;

    // Buat file user dan isi skor awal 0
    myFile.open(userReg + ".txt");
    myFile << 0;
    myFile.close();

    // Simpan username ke list akun
    accList.open("ListAccount.txt", ios::app);
    accList << userReg << endl;
    accList.close();

    system("cls");
    cout << "Registration Successful!" << endl;
    main();
}

// ================= LOGIN & TOP SCORE =================
void login() {
    ifstream myFile;
    string userLog, userData;
    bool exist = false;

    system("cls");
    cout << "----------- LOGIN -----------" << endl;
    cout << "Enter Username : ";
    cin >> userLog;

    // Cek username di ListAccount
    myFile.open("ListAccount.txt");
    while (myFile >> userData) {
        if (userData == userLog) {
            exist = true;
            break;
        }
    }
    myFile.close();

    if (exist) {
        system("cls");
        cout << "Login Successful!" << endl;

        int topScore, currentScore;
        ifstream scoreCheck;
        ofstream scoreFile;

        cout << "Input Top Score : ";
        cin >> topScore;

        // Ambil skor lama
        scoreCheck.open(userLog + ".txt");
        scoreCheck >> currentScore;
        scoreCheck.close();

        // Bandingkan skor
        if (topScore > currentScore) {
            scoreFile.open(userLog + ".txt");
            scoreFile << topScore << endl;
            scoreFile.close();
            cout << "\nYour Top Score Is : " << topScore << endl;
        } else {
            cout << "\nYour Top Score Is Still : " << currentScore << endl;
        }
    } else {
        system("cls");
        cout << "-----------------------------" << endl;
        cout << "        LOGIN ERROR          " << endl;
        cout << "Please check your username!" << endl;
        cout << "-----------------------------" << endl;
        main();
    }
int main() {

    int choice;
    cout << "1. Registration" << endl;
    cout << "2. Login" << endl;
    cout << "3. Input Your Choice : ";
    cin >> choice;

    switch (choice) {
        case 1:
            registration();
            break;

        case 2:
            login();
            break;
    }
}
